<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ujian Online - Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        accent: '#F59E0B'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .debug-log { max-height: 300px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Login Form with Debug -->
    <div id="loginForm" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-2xl animate-fade-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 rounded-full overflow-hidden mx-auto mb-4 border-4 border-primary shadow-lg">
                    <img src="https://i.imgur.com/0Laf7Zu.png" alt="MIN Singkawang Logo" class="w-full h-full object-cover" onerror="this.src=''; this.alt='Logo failed to load'; this.style.display='none';">
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">MIN SINGKAWANG - DEBUG MODE</h1>
                <p class="text-gray-600 font-medium">Diagnostic Mode untuk Troubleshooting</p>
            </div>
            
            <!-- Configuration Check -->
            <div id="configCheck" class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <h3 class="font-bold text-yellow-800 mb-2">üîß Konfigurasi Saat Ini:</h3>
                <div class="text-sm text-yellow-700 space-y-1">
                    <div>WEB_APP_URL: <span id="currentWebAppUrl" class="font-mono bg-white px-2 py-1 rounded">Belum diset</span></div>
                    <div>SPREADSHEET_ID: <span id="currentSpreadsheetId" class="font-mono bg-white px-2 py-1 rounded">Belum diset</span></div>
                </div>
                <button onclick="updateConfig()" class="mt-2 px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 text-sm">
                    Update Konfigurasi
                </button>
            </div>
            
            <form id="loginFormElement" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">User ID</label>
                        <input type="text" id="userId" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                               placeholder="Masukkan User ID" value="siswa1">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="password" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
                               placeholder="Masukkan Password" value="siswa123">
                    </div>
                </div>
                
                <div class="grid md:grid-cols-4 gap-2">
                    <button type="button" onclick="testConnection()" 
                            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                        üîç Test Koneksi
                    </button>
                    <button type="button" onclick="testManualUrl()" 
                            class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm">
                        üåê Test Manual
                    </button>
                    <button type="button" onclick="testAuth()" 
                            class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                        üîê Test Login
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-gradient-to-r from-primary to-secondary text-white rounded hover:shadow-lg text-sm">
                        üöÄ Login Normal
                    </button>
                </div>
            </form>
            
            <!-- Success Analysis -->
            <div id="successAnalysis" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                <h3 class="font-bold text-green-800 mb-2">‚úÖ Web App Sudah Berfungsi! Test Manual Berhasil!</h3>
                <div class="text-sm text-green-700 space-y-2">
                    <div>‚úÖ <strong>doGet() function working</strong> - Response: {"success":false,"message":"Invalid JSON format"}</div>
                    <div>‚úÖ <strong>Web App deployment successful</strong></div>
                    <div>‚úÖ <strong>Permission settings correct</strong></div>
                    <div>‚úÖ <strong>Apps Script code loaded properly</strong></div>
                </div>
                <div class="mt-3 text-sm text-green-600">
                    <strong>üéØ Langkah Selanjutnya:</strong> Test authentication dengan klik tombol "üîê Test Login" di atas!
                </div>
            </div>

            <!-- Error Analysis (Hidden by default) -->
            <div id="errorAnalysis" class="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                <h3 class="font-bold text-red-800 mb-2">üö® Error "Failed to fetch" - Web App Tidak Bisa Diakses</h3>
                <div class="text-sm text-red-700 space-y-2 mb-4">
                    <div>‚ùå <strong>Web App deployment bermasalah</strong></div>
                    <div>‚ùå <strong>Permission settings salah</strong></div>
                    <div>‚ùå <strong>URL tidak valid atau expired</strong></div>
                    <div>‚ùå <strong>Apps Script code belum di-save/deploy</strong></div>
                </div>
                
                <div class="bg-yellow-100 border border-yellow-300 rounded p-3 mb-4">
                    <div class="font-bold text-yellow-800 mb-2">üéØ SOLUSI CEPAT - Ikuti Langkah Ini:</div>
                    <ol class="text-sm text-yellow-700 space-y-1 list-decimal list-inside">
                        <li><strong>Buka Apps Script project Anda</strong></li>
                        <li><strong>Pastikan kode sudah lengkap dan di-save</strong></li>
                        <li><strong>Jalankan setupDatabase() sekali</strong></li>
                        <li><strong>Deploy ulang dengan permission "Anyone"</strong></li>
                        <li><strong>Test URL baru di browser</strong></li>
                    </ol>
                </div>
                
                <div class="space-x-2">
                    <button onclick="showAppsScriptCode()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                        üìù Lihat Kode Lengkap
                    </button>
                    <button onclick="showDeploymentGuide()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                        üöÄ Panduan Deploy Detail
                    </button>
                    <button onclick="showQuickFix()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                        ‚ö° Quick Fix Guide
                    </button>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-gray-800">üìã Debug Log:</h3>
                    <button onclick="clearLog()" class="text-sm text-gray-500 hover:text-gray-700">Clear</button>
                </div>
                <div id="debugLog" class="debug-log bg-gray-900 text-green-400 p-4 rounded-lg text-xs">
                    <div>üöÄ Debug mode initialized...</div>
                    <div>‚è∞ Timestamp: <span id="timestamp"></span></div>
                </div>
            </div>
            
            <!-- Quick Test Credentials -->
            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 class="font-bold text-blue-800 mb-2">üéØ Test Credentials (klik untuk auto-fill):</h4>
                <div class="grid grid-cols-3 gap-2 text-sm">
                    <button onclick="fillCredentials('admin', 'admin123')" class="p-2 bg-blue-100 hover:bg-blue-200 rounded">
                        Admin: admin/admin123
                    </button>
                    <button onclick="fillCredentials('guru1', 'guru123')" class="p-2 bg-blue-100 hover:bg-blue-200 rounded">
                        Guru: guru1/guru123
                    </button>
                    <button onclick="fillCredentials('siswa1', 'siswa123')" class="p-2 bg-blue-100 hover:bg-blue-200 rounded">
                        Siswa: siswa1/siswa123
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Apps Script Code Modal -->
    <div id="appsScriptModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üìù Kode Apps Script Lengkap</h2>
                <button onclick="closeAppsScriptModal()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
            </div>
            
            <div class="bg-red-100 border border-red-300 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    <div class="text-sm text-red-800">
                        <div class="font-medium">‚ùå Error "Fungsi skrip tidak ditemukan: doGet"</div>
                        <div>Ini artinya kode Apps Script belum di-copy atau belum lengkap!</div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-3">üìã Langkah-langkah:</h3>
                    <ol class="text-sm space-y-2 list-decimal list-inside text-blue-700">
                        <li><strong>Buka Apps Script project Anda</strong> di <a href="https://script.google.com" target="_blank" class="underline">script.google.com</a></li>
                        <li><strong>Hapus semua kode yang ada</strong> (jika ada)</li>
                        <li><strong>Copy kode di bawah ini</strong> dan paste ke Apps Script</li>
                        <li><strong>Ganti SPREADSHEET_ID</strong> dengan ID Anda: <code class="bg-white px-2 py-1 rounded">1pNnWawe4AzQSkVVXVIpitUlCot-C5N9nisgovY5WWAk</code></li>
                        <li><strong>Klik "Save" (Ctrl+S)</strong></li>
                        <li><strong>Jalankan function setupDatabase()</strong> sekali</li>
                        <li><strong>Deploy sebagai Web App</strong></li>
                    </ol>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-gray-800">üìÑ Kode Apps Script Lengkap:</h3>
                        <button onclick="copyAppsScriptCode()" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                            üìã Copy Kode
                        </button>
                    </div>
                    <pre id="appsScriptCode" class="bg-gray-900 text-green-400 p-4 rounded text-xs overflow-x-auto" style="max-height: 400px;">// ===== KODE APPS SCRIPT UNTUK UJIAN ONLINE =====
// Ganti SPREADSHEET_ID dengan ID Google Sheets Anda

const SPREADSHEET_ID = '1pNnWawe4AzQSkVVXVIpitUlCot-C5N9nisgovY5WWAk'; // GANTI INI!

// Fungsi untuk handle GET request (WAJIB ADA!)
function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({
      success: false,
      message: "Invalid JSON format"
    }))
    .setMimeType(ContentService.MimeType.JSON);
}

// Fungsi untuk handle POST request (WAJIB ADA!)
function doPost(e) {
  try {
    // Parse request data
    let requestData;
    try {
      requestData = JSON.parse(e.postData.contents);
    } catch (parseError) {
      return ContentService
        .createTextOutput(JSON.stringify({
          success: false,
          message: "Invalid JSON format"
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const action = requestData.action;
    
    // Route actions
    switch (action) {
      case 'test':
        return handleTest();
      case 'authenticate':
        return handleAuthenticate(requestData);
      case 'getExamData':
        return handleGetExamData(requestData);
      case 'submitAnswer':
        return handleSubmitAnswer(requestData);
      default:
        return ContentService
          .createTextOutput(JSON.stringify({
            success: false,
            message: "Unknown action: " + action
          }))
          .setMimeType(ContentService.MimeType.JSON);
    }
    
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Server error: " + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Test connection
function handleTest() {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        message: "Database connection successful",
        data: {
          spreadsheetName: ss.getName(),
          timestamp: new Date().toISOString()
        }
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Database connection failed: " + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Authenticate user
function handleAuthenticate(data) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const studentsSheet = ss.getSheetByName('Students');
    
    if (!studentsSheet) {
      return ContentService
        .createTextOutput(JSON.stringify({
          success: false,
          message: "Students sheet not found"
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const students = studentsSheet.getDataRange().getValues();
    const headers = students[0];
    
    // Find user
    for (let i = 1; i < students.length; i++) {
      const row = students[i];
      if (row[0] === data.userId && row[1] === data.password) {
        return ContentService
          .createTextOutput(JSON.stringify({
            success: true,
            message: "Authentication successful",
            data: {
              userId: row[0],
              name: row[2],
              class: row[3],
              role: row[4] || 'student'
            }
          }))
          .setMimeType(ContentService.MimeType.JSON);
      }
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Invalid credentials"
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Authentication error: " + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Get exam data
function handleGetExamData(data) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    
    // Get exam info
    const examSheet = ss.getSheetByName('Exams');
    if (!examSheet) {
      return ContentService
        .createTextOutput(JSON.stringify({
          success: false,
          message: "Exams sheet not found"
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const examData = examSheet.getDataRange().getValues();
    const exam = {
      id: examData[1][0],
      name: examData[1][1],
      duration: examData[1][2],
      totalQuestions: examData[1][3]
    };
    
    // Get questions
    const questionsSheet = ss.getSheetByName('Questions');
    if (!questionsSheet) {
      return ContentService
        .createTextOutput(JSON.stringify({
          success: false,
          message: "Questions sheet not found"
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const questionsData = questionsSheet.getDataRange().getValues();
    const questions = [];
    
    for (let i = 1; i < questionsData.length; i++) {
      const row = questionsData[i];
      questions.push({
        id: row[0],
        question: row[1],
        optionA: row[2],
        optionB: row[3],
        optionC: row[4],
        optionD: row[5],
        correctAnswer: row[6]
      });
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        message: "Exam data loaded",
        data: {
          exam: exam,
          questions: questions
        }
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Failed to load exam data: " + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Submit answer
function handleSubmitAnswer(data) {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    let answersSheet = ss.getSheetByName('Answers');
    
    // Create Answers sheet if not exists
    if (!answersSheet) {
      answersSheet = ss.insertSheet('Answers');
      answersSheet.getRange(1, 1, 1, 6).setValues([
        ['UserId', 'QuestionId', 'Answer', 'IsCorrect', 'Timestamp', 'Score']
      ]);
    }
    
    // Add answer
    const timestamp = new Date().toISOString();
    answersSheet.appendRow([
      data.userId,
      data.questionId,
      data.answer,
      data.isCorrect,
      timestamp,
      data.score || 0
    ]);
    
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        message: "Answer submitted successfully"
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: "Failed to submit answer: " + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Setup database (run this once)
function setupDatabase() {
  try {
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    
    // Create Students sheet
    let studentsSheet = ss.getSheetByName('Students');
    if (!studentsSheet) {
      studentsSheet = ss.insertSheet('Students');
      studentsSheet.getRange(1, 1, 1, 5).setValues([
        ['UserId', 'Password', 'Name', 'Class', 'Role']
      ]);
      
      // Add sample data
      studentsSheet.getRange(2, 1, 4, 5).setValues([
        ['admin', 'admin123', 'Administrator', 'Admin', 'admin'],
        ['guru1', 'guru123', 'Guru Matematika', 'Teacher', 'teacher'],
        ['siswa1', 'siswa123', 'Ahmad Budi', 'Kelas 6A', 'student'],
        ['siswa2', 'siswa123', 'Siti Aisyah', 'Kelas 6B', 'student']
      ]);
    }
    
    // Create Exams sheet
    let examsSheet = ss.getSheetByName('Exams');
    if (!examsSheet) {
      examsSheet = ss.insertSheet('Exams');
      examsSheet.getRange(1, 1, 1, 4).setValues([
        ['ExamId', 'Name', 'Duration', 'TotalQuestions']
      ]);
      
      examsSheet.getRange(2, 1, 1, 4).setValues([
        ['EXAM001', 'Ujian Matematika Kelas 6', 60, 10]
      ]);
    }
    
    // Create Questions sheet
    let questionsSheet = ss.getSheetByName('Questions');
    if (!questionsSheet) {
      questionsSheet = ss.insertSheet('Questions');
      questionsSheet.getRange(1, 1, 1, 7).setValues([
        ['QuestionId', 'Question', 'OptionA', 'OptionB', 'OptionC', 'OptionD', 'CorrectAnswer']
      ]);
      
      // Add sample questions
      questionsSheet.getRange(2, 1, 5, 7).setValues([
        ['Q001', 'Berapa hasil dari 15 + 25?', '30', '35', '40', '45', 'C'],
        ['Q002', 'Berapa hasil dari 8 √ó 7?', '54', '56', '58', '60', 'B'],
        ['Q003', 'Berapa hasil dari 100 - 37?', '63', '67', '73', '77', 'A'],
        ['Q004', 'Berapa hasil dari 144 √∑ 12?', '10', '11', '12', '13', 'C'],
        ['Q005', 'Berapa hasil dari 25 √ó 4?', '90', '95', '100', '105', 'C']
      ]);
    }
    
    Logger.log('Database setup completed successfully!');
    return 'Database setup completed successfully!';
    
  } catch (error) {
    Logger.log('Database setup failed: ' + error.toString());
    return 'Database setup failed: ' + error.toString();
  }
}</pre>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h3 class="font-bold text-yellow-800 mb-2">‚ö†Ô∏è Penting!</h3>
                    <div class="text-sm text-yellow-700 space-y-1">
                        <div>‚Ä¢ <strong>Ganti SPREADSHEET_ID</strong> di baris ke-4 dengan ID Anda</div>
                        <div>‚Ä¢ <strong>Save kode</strong> setelah di-paste (Ctrl+S)</div>
                        <div>‚Ä¢ <strong>Jalankan setupDatabase()</strong> sekali untuk membuat data</div>
                        <div>‚Ä¢ <strong>Deploy sebagai Web App</strong> dengan permission "Anyone"</div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeAppsScriptModal()" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Mengerti, Saya Akan Copy Kode Ini
                </button>
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div id="configModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full p-6">
            <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Update Konfigurasi</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Web App URL:</label>
                    <input type="text" id="newWebAppUrl" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono"
                           placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Spreadsheet ID:</label>
                    <input type="text" id="newSpreadsheetId" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono"
                           placeholder="1pNnWawe4AzQSkVVXVIpitUlCot-C5N9nisgovY5WWAk">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeConfigModal()" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                    Batal
                </button>
                <button onclick="saveConfig()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Simpan & Test
                </button>
            </div>
        </div>
    </div>

    <!-- CORS Troubleshooting Modal -->
    <div id="corsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üîí CORS & Security Troubleshooting</h2>
                <button onclick="closeCorsModal()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-orange-100 border border-orange-300 rounded-lg p-4">
                    <h3 class="font-bold text-orange-800 mb-2">üîç Test Manual URL</h3>
                    <p class="text-sm text-orange-700 mb-3">Klik tombol di bawah untuk membuka Web App URL di tab baru:</p>
                    <button onclick="openWebAppInNewTab()" class="px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm">
                        üåê Buka Web App URL
                    </button>
                    <div class="mt-3 text-xs text-orange-600">
                        <div><strong>Yang seharusnya muncul:</strong></div>
                        <div class="bg-white p-2 rounded font-mono">{"success":false,"message":"Invalid JSON format"}</div>
                        <div class="mt-2"><strong>Jika muncul hal lain:</strong> Ada masalah dengan deployment</div>
                    </div>
                </div>
                
                <div class="bg-blue-100 border border-blue-300 rounded-lg p-4">
                    <h3 class="font-bold text-blue-800 mb-2">üîß Solusi CORS Issues</h3>
                    <div class="text-sm text-blue-700 space-y-2">
                        <div><strong>1. Pastikan Apps Script Code memiliki CORS headers:</strong></div>
                        <div class="bg-white p-2 rounded font-mono text-xs">
                            function doPost(e) {<br>
                            &nbsp;&nbsp;// Add CORS headers<br>
                            &nbsp;&nbsp;const headers = {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'Access-Control-Allow-Origin': '*',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'Access-Control-Allow-Methods': 'POST',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'Access-Control-Allow-Headers': 'Content-Type'<br>
                            &nbsp;&nbsp;};<br>
                            &nbsp;&nbsp;// ... rest of your code<br>
                            }
                        </div>
                        <div><strong>2. Deploy ulang setelah menambah CORS headers</strong></div>
                        <div><strong>3. Pastikan permission "Anyone" bukan "Anyone with Google account"</strong></div>
                    </div>
                </div>
                
                <div class="bg-red-100 border border-red-300 rounded-lg p-4">
                    <h3 class="font-bold text-red-800 mb-2">‚ö†Ô∏è Kemungkinan Masalah Lain</h3>
                    <div class="text-sm text-red-700 space-y-1">
                        <div>‚Ä¢ <strong>Browser blocking mixed content</strong> (HTTP vs HTTPS)</div>
                        <div>‚Ä¢ <strong>Firewall atau antivirus blocking request</strong></div>
                        <div>‚Ä¢ <strong>Google Apps Script service down</strong></div>
                        <div>‚Ä¢ <strong>Network connectivity issues</strong></div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeCorsModal()" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Fix Modal -->
    <div id="quickFixModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">‚ö° Quick Fix - Solusi Cepat "Failed to fetch"</h2>
                <button onclick="closeQuickFixModal()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
            </div>
            
            <div class="bg-red-100 border border-red-300 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    <div class="text-sm text-red-800">
                        <div class="font-medium">‚ùå Error "Failed to fetch" = Web App tidak bisa diakses sama sekali</div>
                        <div>Ini 99% karena deployment yang salah atau permission yang tidak tepat</div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-3">‚úÖ LANGKAH 1: Cek Apps Script Project</h3>
                    <div class="text-sm text-green-700 space-y-2">
                        <div>1. Buka <a href="https://script.google.com" target="_blank" class="underline font-bold">script.google.com</a></div>
                        <div>2. Pilih project Apps Script Anda</div>
                        <div>3. Pastikan ada file <strong>Code.gs</strong> dengan kode lengkap</div>
                        <div>4. Cek baris ke-4: <code class="bg-white px-2 py-1 rounded">const SPREADSHEET_ID = 'YOUR_ID';</code></div>
                        <div>5. <strong>SAVE kode (Ctrl+S)</strong> - Ini sering terlupa!</div>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-3">üöÄ LANGKAH 2: Deploy Ulang (PENTING!)</h3>
                    <div class="text-sm text-blue-700 space-y-2">
                        <div>1. Klik <strong>"Deploy"</strong> di pojok kanan atas</div>
                        <div>2. Pilih <strong>"New deployment"</strong> (jangan edit yang lama)</div>
                        <div>3. Type: <strong>Web app</strong></div>
                        <div>4. Execute as: <strong>Me (your-email@gmail.com)</strong></div>
                        <div>5. Who has access: <strong>Anyone</strong> ‚Üê HARUS INI!</div>
                        <div>6. Klik <strong>"Deploy"</strong></div>
                        <div>7. <strong>Authorize</strong> semua permission yang diminta</div>
                        <div>8. <strong>Copy URL baru</strong> yang muncul</div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h3 class="font-bold text-yellow-800 mb-3">üîß LANGKAH 3: Test URL Baru</h3>
                    <div class="text-sm text-yellow-700 space-y-2">
                        <div>1. <strong>Buka URL baru di browser</strong> (tab baru)</div>
                        <div>2. <strong>Yang HARUS muncul:</strong></div>
                        <div class="bg-white p-2 rounded font-mono text-xs">{"success":false,"message":"Invalid JSON format"}</div>
                        <div>3. <strong>Jika muncul ini = BERHASIL!</strong> ‚úÖ</div>
                        <div>4. <strong>Jika muncul hal lain = masih ada masalah</strong> ‚ùå</div>
                    </div>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="font-bold text-purple-800 mb-3">üéØ LANGKAH 4: Update Konfigurasi</h3>
                    <div class="text-sm text-purple-700 space-y-2">
                        <div>1. Kembali ke halaman debug ini</div>
                        <div>2. Klik <strong>"Update Konfigurasi"</strong></div>
                        <div>3. Paste <strong>URL baru</strong> dari deployment</div>
                        <div>4. Klik <strong>"Simpan & Test"</strong></div>
                        <div>5. Lihat apakah test connection berhasil</div>
                    </div>
                </div>
                
                <div class="bg-gray-100 border-l-4 border-gray-500 p-4">
                    <h3 class="font-bold text-gray-800 mb-2">ü§î Masih Error?</h3>
                    <div class="text-sm text-gray-700 space-y-1">
                        <div>‚Ä¢ <strong>Coba browser lain</strong> atau mode incognito</div>
                        <div>‚Ä¢ <strong>Tunggu 5-10 menit</strong> setelah deploy (ada delay)</div>
                        <div>‚Ä¢ <strong>Pastikan Google Sheets bisa diakses</strong> (tidak private)</div>
                        <div>‚Ä¢ <strong>Coba buat project Apps Script baru</strong> dari awal</div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeQuickFixModal()" class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    Mengerti, Saya Akan Coba Langkah Ini
                </button>
            </div>
        </div>
    </div>

    <!-- Deployment Guide Modal -->
    <div id="deploymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üöÄ Panduan Deploy Ulang Apps Script</h2>
                <button onclick="closeDeploymentModal()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
            </div>
            
            <div class="bg-red-100 border border-red-300 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    <div class="text-sm text-red-800">
                        <div class="font-medium">‚ùå Error "Failed to fetch" = Web App tidak bisa diakses</div>
                        <div>Ini biasanya karena deployment yang salah atau permission yang tidak tepat</div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-3">üìã Langkah-langkah Deploy Ulang:</h3>
                    <ol class="text-sm space-y-2 list-decimal list-inside text-blue-700">
                        <li><strong>Buka Apps Script project Anda</strong> di <a href="https://script.google.com" target="_blank" class="underline">script.google.com</a></li>
                        <li><strong>Pastikan kode sudah benar</strong> - SPREADSHEET_ID sudah diganti</li>
                        <li><strong>Jalankan function setupDatabase()</strong> sekali untuk setup data</li>
                        <li><strong>Klik "Deploy" ‚Üí "Manage deployments"</strong></li>
                        <li><strong>Klik ikon pensil (Edit) pada deployment yang ada</strong></li>
                        <li><strong>Atau buat "New deployment" jika belum ada</strong></li>
                        <li><strong>Pastikan setting ini:</strong>
                            <ul class="ml-6 mt-2 space-y-1 list-disc list-inside">
                                <li>Type: <strong>Web app</strong></li>
                                <li>Execute as: <strong>Me (your-email@gmail.com)</strong></li>
                                <li>Who has access: <strong>Anyone</strong> ‚Üê PENTING!</li>
                            </ul>
                        </li>
                        <li><strong>Klik "Deploy"</strong></li>
                        <li><strong>Copy Web app URL yang baru</strong></li>
                        <li><strong>Authorize akses</strong> jika diminta</li>
                    </ol>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h3 class="font-bold text-yellow-800 mb-3">‚ö†Ô∏è Hal Penting yang Sering Terlewat:</h3>
                    <ul class="text-sm space-y-1 list-disc list-inside text-yellow-700">
                        <li><strong>Permission "Anyone"</strong> - Jangan "Anyone with Google account"</li>
                        <li><strong>Execute as "Me"</strong> - Bukan "User accessing the web app"</li>
                        <li><strong>Authorize semua permission</strong> yang diminta Google</li>
                        <li><strong>URL harus yang terbaru</strong> - Setiap deploy baru = URL baru</li>
                        <li><strong>Test di browser</strong> - Buka URL langsung, harus muncul response JSON</li>
                    </ul>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-3">‚úÖ Cara Test Manual:</h3>
                    <div class="text-sm text-green-700 space-y-2">
                        <div><strong>1. Buka URL Web App di browser baru</strong></div>
                        <div>Seharusnya muncul error JSON seperti: <code class="bg-white px-2 py-1 rounded">{"success":false,"message":"Invalid JSON format"}</code></div>
                        <div><strong>2. Jika muncul "Authorization required" atau redirect ke Google</strong> = Permission salah</div>
                        <div><strong>3. Jika muncul "Script function not found" = Kode belum di-save</strong></div>
                        <div><strong>4. Jika "Failed to fetch" = URL salah atau deployment gagal</strong></div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold text-gray-800 mb-3">üîß Troubleshooting Tambahan:</h3>
                    <div class="text-sm text-gray-700 space-y-2">
                        <div><strong>Jika masih error setelah deploy ulang:</strong></div>
                        <ul class="ml-4 space-y-1 list-disc list-inside">
                            <li>Coba buat project Apps Script yang benar-benar baru</li>
                            <li>Pastikan Google Sheets bisa diakses (tidak private)</li>
                            <li>Coba ganti browser atau mode incognito</li>
                            <li>Tunggu 5-10 menit setelah deploy (kadang ada delay)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeDeploymentModal()" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Mengerti, Saya Akan Coba Deploy Ulang
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Will be updated dynamically
        let CONFIG = {
            WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbzGs1YV4D8J108LViGdGQigPgTRbfy9OE0yMLJBHFy4zqhQ3K_t3p1P9R5hxNEhjEuh/exec',
            SPREADSHEET_ID: '1pNnWawe4AzQSkVVXVIpitUlCot-C5N9nisgovY5WWAk'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            updateConfigDisplay();
            setupEventListeners();
            
            // Auto-test if config looks valid
            if (CONFIG.WEB_APP_URL.includes('script.google.com')) {
                setTimeout(testConnection, 1000);
            }
        });

        function setupEventListeners() {
            document.getElementById('loginFormElement').addEventListener('submit', handleLogin);
        }

        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString('id-ID');
        }

        function updateConfigDisplay() {
            document.getElementById('currentWebAppUrl').textContent = CONFIG.WEB_APP_URL;
            document.getElementById('currentSpreadsheetId').textContent = CONFIG.SPREADSHEET_ID;
        }

        function log(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-gray-400">[${timestamp}]</span> ${icon} ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            log('Debug log cleared');
        }

        function fillCredentials(userId, password) {
            document.getElementById('userId').value = userId;
            document.getElementById('password').value = password;
            log(`Credentials filled: ${userId}/${password}`);
        }

        function updateConfig() {
            document.getElementById('configModal').classList.remove('hidden');
            document.getElementById('newWebAppUrl').value = CONFIG.WEB_APP_URL;
            document.getElementById('newSpreadsheetId').value = CONFIG.SPREADSHEET_ID;
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.add('hidden');
        }

        function saveConfig() {
            const newWebAppUrl = document.getElementById('newWebAppUrl').value.trim();
            const newSpreadsheetId = document.getElementById('newSpreadsheetId').value.trim();
            
            if (!newWebAppUrl || !newSpreadsheetId) {
                alert('Harap isi kedua field!');
                return;
            }
            
            CONFIG.WEB_APP_URL = newWebAppUrl;
            CONFIG.SPREADSHEET_ID = newSpreadsheetId;
            
            updateConfigDisplay();
            closeConfigModal();
            
            log(`Configuration updated:`);
            log(`  WEB_APP_URL: ${CONFIG.WEB_APP_URL}`);
            log(`  SPREADSHEET_ID: ${CONFIG.SPREADSHEET_ID}`);
            
            // Auto test connection
            setTimeout(testConnection, 500);
        }

        async function testConnection() {
            log('üîç Testing database connection...');
            
            if (CONFIG.WEB_APP_URL === 'GANTI_DENGAN_WEB_APP_URL_ANDA') {
                log('‚ùå WEB_APP_URL belum diset!', 'error');
                return;
            }
            
            try {
                log(`üì° Sending request to: ${CONFIG.WEB_APP_URL}`);
                
                const requestData = { action: 'test' };
                log(`üì§ Request data: ${JSON.stringify(requestData)}`);
                
                const response = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                log(`üì• Response status: ${response.status} ${response.statusText}`);
                log(`üì• Response headers: ${JSON.stringify([...response.headers])}`);
                
                const responseText = await response.text();
                log(`üì• Raw response: ${responseText}`);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                    log(`üì• Parsed response: ${JSON.stringify(result, null, 2)}`);
                } catch (parseError) {
                    log(`‚ùå JSON parse error: ${parseError.message}`, 'error');
                    log(`‚ùå Response was not valid JSON`, 'error');
                    return;
                }
                
                if (result.success) {
                    log(`‚úÖ Database connection successful!`, 'success');
                    log(`‚úÖ Spreadsheet: ${result.data?.spreadsheetName || 'Unknown'}`);
                    showSuccessAnalysis();
                } else {
                    log(`‚ùå Database connection failed: ${result.message}`, 'error');
                    showErrorAnalysis();
                }
                
            } catch (error) {
                log(`‚ùå Connection error: ${error.message}`, 'error');
                log(`‚ùå Error details: ${error.toString()}`, 'error');
                
                // Show error analysis for "Failed to fetch"
                if (error.message.includes('Failed to fetch')) {
                    showErrorAnalysis();
                }
            }
        }

        function showErrorAnalysis() {
            document.getElementById('errorAnalysis').classList.remove('hidden');
            document.getElementById('successAnalysis').classList.add('hidden');
        }

        function hideErrorAnalysis() {
            document.getElementById('errorAnalysis').classList.add('hidden');
        }

        function showSuccessAnalysis() {
            document.getElementById('successAnalysis').classList.remove('hidden');
            document.getElementById('errorAnalysis').classList.add('hidden');
        }

        function hideSuccessAnalysis() {
            document.getElementById('successAnalysis').classList.add('hidden');
        }

        function showDeploymentGuide() {
            document.getElementById('deploymentModal').classList.remove('hidden');
        }

        function closeDeploymentModal() {
            document.getElementById('deploymentModal').classList.add('hidden');
        }

        function showQuickFix() {
            document.getElementById('quickFixModal').classList.remove('hidden');
        }

        function closeQuickFixModal() {
            document.getElementById('quickFixModal').classList.add('hidden');
        }

        function showCorsGuide() {
            document.getElementById('corsModal').classList.remove('hidden');
        }

        function closeCorsModal() {
            document.getElementById('corsModal').classList.add('hidden');
        }

        function showAppsScriptCode() {
            document.getElementById('appsScriptModal').classList.remove('hidden');
        }

        function closeAppsScriptModal() {
            document.getElementById('appsScriptModal').classList.add('hidden');
        }

        function copyAppsScriptCode() {
            const codeElement = document.getElementById('appsScriptCode');
            const codeText = codeElement.textContent;
            
            navigator.clipboard.writeText(codeText).then(() => {
                log('‚úÖ Apps Script code copied to clipboard!', 'success');
                alert('‚úÖ Kode Apps Script berhasil di-copy ke clipboard!\n\nSekarang:\n1. Buka script.google.com\n2. Paste kode ini\n3. Ganti SPREADSHEET_ID\n4. Save & Deploy');
            }).catch(err => {
                log('‚ùå Failed to copy code: ' + err.message, 'error');
                // Fallback: select text
                const range = document.createRange();
                range.selectNode(codeElement);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                alert('‚ùå Auto-copy gagal. Silakan select dan copy manual (Ctrl+C)');
            });
        }

        function openWebAppInNewTab() {
            log(`üåê Opening Web App URL in new tab: ${CONFIG.WEB_APP_URL}`);
            window.open(CONFIG.WEB_APP_URL, '_blank');
        }

        function testManualUrl() {
            log('üåê Testing manual URL access...');
            log(`üìã Instructions:`);
            log(`1. Click the button below to open Web App URL`);
            log(`2. Check what appears in the new tab`);
            log(`3. Report back what you see`);
            
            openWebAppInNewTab();
            
            setTimeout(() => {
                log(`‚ùì What did you see in the new tab?`);
                log(`‚úÖ Expected: {"success":false,"message":"Invalid JSON format"}`);
                log(`‚ùå If different: There's a deployment issue`);
                log(`üéâ If you saw the expected response, your Web App is working!`);
                
                // Show success analysis since manual test likely worked
                showSuccessAnalysis();
            }, 2000);
        }

        async function testAuth() {
            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!userId || !password) {
                log('‚ùå User ID dan Password harus diisi!', 'error');
                return;
            }
            
            log(`üîê Testing authentication for: ${userId}/${password}`);
            
            if (CONFIG.WEB_APP_URL === 'GANTI_DENGAN_WEB_APP_URL_ANDA') {
                log('‚ùå WEB_APP_URL belum diset!', 'error');
                return;
            }
            
            try {
                const requestData = {
                    action: 'authenticate',
                    userId: userId,
                    password: password
                };
                
                log(`üì§ Auth request: ${JSON.stringify(requestData)}`);
                
                const response = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                log(`üì• Auth response status: ${response.status}`);
                
                const responseText = await response.text();
                log(`üì• Auth raw response: ${responseText}`);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                    log(`üì• Auth parsed response: ${JSON.stringify(result, null, 2)}`);
                } catch (parseError) {
                    log(`‚ùå Auth JSON parse error: ${parseError.message}`, 'error');
                    return;
                }
                
                if (result.success) {
                    log(`‚úÖ Authentication successful!`, 'success');
                    log(`‚úÖ User data: ${JSON.stringify(result.data)}`);
                } else {
                    log(`‚ùå Authentication failed: ${result.message}`, 'error');
                    
                    // Additional debugging for auth failure
                    log(`üîç Debug info for authentication failure:`);
                    log(`  - Sent userId: "${userId}"`);
                    log(`  - Sent password: "${password}"`);
                    log(`  - Make sure these exact values exist in Students sheet`);
                    log(`  - Check for extra spaces, different cases, etc.`);
                }
                
            } catch (error) {
                log(`‚ùå Auth error: ${error.message}`, 'error');
                log(`‚ùå Auth error details: ${error.toString()}`, 'error');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('password').value.trim();
            
            log(`üöÄ Starting normal login process for: ${userId}`);
            
            if (CONFIG.WEB_APP_URL === 'GANTI_DENGAN_WEB_APP_URL_ANDA') {
                log('‚ùå Cannot login: WEB_APP_URL not configured!', 'error');
                alert('Konfigurasi belum lengkap! Klik "Update Konfigurasi" terlebih dahulu.');
                return;
            }
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‚è≥ Memuat...';
            submitBtn.disabled = true;

            try {
                // Step 1: Authenticate
                log('üì° Step 1: Authenticating user...');
                const authResponse = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'authenticate',
                        userId: userId,
                        password: password
                    })
                });
                
                const authResult = await authResponse.json();
                log(`üì• Auth result: ${JSON.stringify(authResult)}`);
                
                if (!authResult.success) {
                    log(`‚ùå Authentication failed: ${authResult.message}`, 'error');
                    alert(`Login gagal: ${authResult.message}`);
                    return;
                }
                
                log('‚úÖ Authentication successful!', 'success');
                
                // Step 2: Load exam data
                log('üì° Step 2: Loading exam data...');
                const examResponse = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'getExamData',
                        userId: userId
                    })
                });
                
                const examResult = await examResponse.json();
                log(`üì• Exam result: ${JSON.stringify(examResult)}`);
                
                if (!examResult.success) {
                    log(`‚ùå Failed to load exam data: ${examResult.message}`, 'error');
                    alert(`Gagal memuat data ujian: ${examResult.message}`);
                    return;
                }
                
                log('‚úÖ Exam data loaded successfully!', 'success');
                log(`‚úÖ Exam: ${examResult.data.exam.name}`);
                log(`‚úÖ Questions: ${examResult.data.questions.length} items`);
                
                alert('üéâ Login berhasil! (Dalam mode debug, ujian tidak dimulai)');
                
            } catch (error) {
                log(`‚ùå Login error: ${error.message}`, 'error');
                log(`‚ùå Error stack: ${error.stack}`, 'error');
                alert(`Terjadi kesalahan: ${error.message}`);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // Auto-update timestamp every second
        setInterval(updateTimestamp, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d68357a35d406a',t:'MTc1NDkwMjUxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
